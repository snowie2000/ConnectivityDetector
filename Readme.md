Inspired (and basically the full code is provided by https://stackoverflow.com/a/70438810/15358754)